<%- include('./partials/header') %>

<div class="w-full min-h-screen flex items-start px-12 py-16 gap-12">

  <!-- CART ITEMS -->
  <div class="w-[80%] mt-5">

    <% if (cartItems && cartItems.length > 0) { %>

      <!-- GRID: 4 ITEMS PER ROW -->
      <div class="grid grid-cols-3 gap-6">

        <% cartItems.forEach(function(item) { %>

          <!-- CARD -->
          <div class=" overflow-hidden">

            <!-- IMAGE -->
            <div class="h-48 flex items-center justify-center">
              <% if (item.image) { %>
                <img
                  class="h-36 object-contain"
                  src="data:image/jpeg;base64,<%= item.image.toString('base64') %>"
                  alt="<%= item.name %>" />
              <% } else { %>
                <span class="text-gray-500">No Image</span>
              <% } %>
            </div>

            <!-- NAME + QTY -->
            <div class="flex justify-between items-center px-12 py-3 ">
              <h3 class="font-semibold "><%= item.name %></h3>

              <div class="flex items-center gap-1">
                <button class="w-9 h-9 rounded-full flex items-center justify-center text-black hover:bg-gray-600 transition-colors bg-white">
                  <i class="ri-subtract-line text-sm"></i>
                </button>
                <div class="px-2 py-1  rounded text-xxs shadow">01</div>
                <button class="w-9 h-9 rounded-full flex items-center justify-center text-black hover:bg-gray-600 transition-colors bg-white">
                  <i class="ri-add-line text-sm"></i>
                </button>
              </div>
            </div>

            <!-- PRICE -->
            <div class="flex justify-between items-center px-12">
              <span class="">Net Total</span>
              <span class="font-semibold text-sm text-lg">₹ <%= item.price %></span>
            </div>
            <% if(item.discount > 0) { %>
                        <p class="text-sm text-green-600 text-right px-12"><%= item.discount
                            %>% OFF</p>
                        <% } %>

          </div>

        <% }) %>

      </div>

    <% } else { %>

      <div class="w-full h-72 bg-secondary flex flex-col items-center justify-center rounded-lg">
        <h3 class="text-xl font-semibold">Your cart is empty</h3>
        <p class="mt-2 text-secondary">
          Add some products to your cart to see them here
        </p>
      </div>

    <% } %>

  </div>

  <!-- PRICE BREAKDOWN -->
  <div class="w-[20%] border-3 sticky top-28">
    <div class=" shadow-md rounded-xl p-8">

      <h3 class="text-lg font-semibold mb-4">Price Breakdown</h3>

      <div class="space-y-3 text-sm">
        <div class="flex justify-between">
          <span>Total MRP</span>
          <span>
            ₹ <%= cartItems && cartItems.length > 0
              ? cartItems.reduce((t, i) => t + i.price, 0)
              : 0 %>
          </span>
        </div>

        <div class="flex justify-between">
          <span>Discount on MRP</span>
          <span class="text-green-400">
            - ₹ <%= cartItems && cartItems.length > 0
              ? cartItems.reduce((d, i) => {
                  const mrp = Number(i.price)
                  const dis = Number(i.discount) || 0
                  return d + (mrp * dis / 100)
                }, 0)
              : 0 %>
          </span>
        </div>

        <div class="flex justify-between">
          <span>Platform Fee</span>
          <span>₹ 20</span>
        </div>

        <div class="flex justify-between">
          <span>Shipping Fee</span>
          <span class="text-green-400">FREE</span>
        </div>
      </div>

      <div class="w-full h-[1px] bg-gray-300 my-6"></div>

      <div class="flex justify-between items-center">
        <h3 class="text-lg font-semibold">Total Amount</h3>
        <h3 class="font-semibold text-lg text-green-600">
          ₹ <%= cartItems && cartItems.length > 0
            ? (cartItems.reduce((t, i) =>
                t + Number(i.price) * (1 - (Number(i.discount) || 0) / 100),
              0) + 20)
            : 20 %>
        </h3>
      </div>

      <% if (cartItems && cartItems.length > 0) { %>
        <form action="/checkout" method="post">
          <button
            type="submit"
            class="mt-6 w-full px-6 py-3 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition">
            Proceed to Checkout
          </button>
        </form>
      <% } else { %>
        <button
          disabled
          class="mt-6 w-full px-6 py-3 bg-gray-400 text-white rounded-full cursor-not-allowed">
          Proceed to Checkout
        </button>
      <% } %>

    </div>
  </div>

</div>

<%- include('./partials/footer') %>
